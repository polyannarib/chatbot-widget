<app-loading [loader]="loader"></app-loading>

<div id="modal" *ngIf="!loader && type">
  <button type="button" class="close btn" [mat-dialog-close]="true"><i class="material-icons">close</i></button>
  <!--  <div class="calculadora" *ngIf="type.name.toLowerCase() == 'tarefa'">-->
  <!--    <button (click)="openCalculator()" matTooltip="{{ 'OPEN_CALCULATOR' | translate }}" mat-icon-button><i class="material-icons">post_add</i></button>-->
  <!--  </div>-->
  <div class="modal-header">
    <!-- {{ type.name }}  -->
    <span [ngStyle]="{'background-color': mainStyle}"> {{ type.name }} </span>
  </div>
  <button (click)="openCalculator()" *ngIf="type.name.toLowerCase() == 'tarefa'"
    matTooltip="{{ 'OPEN_CALCULATOR' | translate }}" mat-icon-button>
    <i class="material-icons">post_add</i>
  </button>

  <form [formGroup]="form">
    <div class="modal-body">

      <!--      Nome-->
      <div class="input-field">
        <input id="name" type="text" class="validate" formControlName="name">
        <label for="name">Nome</label>
      </div>

      <!--      Descricao-->
      <div class="input-field">
        <input id="description" type="text" class="validate" formControlName="description">
        <label for="description">Descrição</label>
      </div>

      <!--      Esforco-->
      <div class="input-field" *ngIf="type.definition == 'EXECUTAVEL' || kysmart == true">
        <input id="duration" type="number" class="validate" formControlName="duration">
        <label for="duration">Esforço</label>
      </div>

      <!--      Data prevista inicio-->
      <div *ngIf="type.definition == 'EXECUTAVEL'  || kysmart == true">
        <mat-form-field>
          <input matInput [matDatepicker]="expectedAt" formControlName="expectedAt" placeholder="Data prevista inicio">
          <mat-datepicker-toggle matSuffix [for]="expectedAt"></mat-datepicker-toggle>
          <mat-datepicker #expectedAt></mat-datepicker>
        </mat-form-field>
      </div>

      <!--      Horario-->
      <mat-form-field *ngIf="type.definition == 'EXECUTAVEL'">
        <mat-label>Selecione o horário</mat-label>
        <mat-select formControlName="time">
          <mat-option [value]="8"> 08:00 </mat-option>
          <mat-option [value]="9"> 09:00 </mat-option>
          <mat-option [value]="10"> 10:00 </mat-option>
          <mat-option [value]="11"> 11:00 </mat-option>
          <mat-option [value]="14"> 14:00 </mat-option>
          <mat-option [value]="15"> 15:00 </mat-option>
          <mat-option [value]="16"> 16:00 </mat-option>
          <mat-option [value]="17"> 17:00 </mat-option>
        </mat-select>
      </mat-form-field>

      <!--      Recorrencia-->
      <div class="row" *ngIf="type.definition == 'EXECUTAVEL'">
        <mat-form-field style="margin: 5px;">
          <mat-label>Recorrência</mat-label>
          <mat-select formControlName="recurrence">
            <mat-option [value]="'Não se repete'"> Não se repete </mat-option>
            <mat-option [value]="'Todos os dias da semana'"> Todos os dias da semana </mat-option>
            <mat-option [value]="'Semanal'"> Semanal </mat-option>
            <mat-option [value]="'Mensal'"> Mensal </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field style="margin: 5px;" *ngIf="form.value.recurrence !== null && form.value.recurrence.toLowerCase() !== 'não se repete'">
          <input matInput [matDatepicker]="recurrenceEndAt" formControlName="recurrenceEndAt" placeholder="Termina em">
          <mat-datepicker-toggle matSuffix [for]="recurrenceEndAt"></mat-datepicker-toggle>
          <mat-datepicker #recurrenceEndAt></mat-datepicker>
        </mat-form-field>
      </div>

      <!--      Designar-->
      <div style="padding-right: 10px;" *ngIf="type.definition == 'EXECUTAVEL'">
        <button mat-button id="designate" (click)="openDesignatePlayer()" *ngIf="!designatedPlayer">
          <mat-icon aria-lable="Designate icon">account_circle</mat-icon>
          Designar player
        </button>

        <label *ngIf="designatedPlayer">Player</label>
        <p id="designatedPlayer" [ngStyle]="{'background-color': mainStyle}" (click)="openDesignatePlayer()"
          *ngIf="designatedPlayer">
          {{ designatedPlayer.name }}
        </p>
      </div>

      <!-- <mat-form-field class="example-full-width" *ngIf="type.definition == 'EXECUTAVEL'">
        <mat-label>{{ 'CRITICALLYLEVEL' | translate }}</mat-label>
        <mat-select formControlName="criticallyLevel">
          <mat-option [value]="1"> Verde </mat-option>
          <mat-option [value]="2"> Amarelo </mat-option>
          <mat-option [value]="3"> Vermelho </mat-option>
        </mat-select>
      </mat-form-field> -->

      <!-- <figure>
        <pre>
          {{ cards | json }}
        </pre>
      </figure> -->

      <ul class="collection" *ngIf="type.definition == 'EXECUTAVEL' && (cards.length > 0 || cards != [])">
        <label>Cartas</label>
        <li *ngFor="let card of cards" class="collection-item dismissable"
          [ngStyle]="{'background-color': secoundStyle}">
          <div>
            {{ card.cardName }}
            <a (click)="removeCard(card)" class="secondary-content"><i class="material-icons">close</i></a>
          </div>
        </li>
      </ul>

      <ul class="collection" *ngIf="form.value.links.length > 0 && type.definition == 'EXECUTAVEL'">
        <label *ngIf="form.value.links.length > 0">Anexos</label>
        <li *ngFor="let item of form.value.links" class="collection-item dismissable"
          [ngStyle]="{'background-color': secoundStyle}">
          <div>
            <a target="_blank" href="{{ item.url }}">{{ item.description }}</a>
            <!-- <a (click)="removeAttachment(item)" class="secondary-content"><i class="material-icons">close</i></a> -->
          </div>
        </li>
      </ul>

    </div>
    <div class="modal-footer">
      <button *ngIf="type.definition == 'EXECUTAVEL'" (click)="addCard()" class="button left"
        [ngStyle]="{'background-color': mainStyle}">{{ 'Adicionar carta' | translate }}</button>
      <button *ngIf="type.definition == 'EXECUTAVEL'" (click)="setAttachment()" matTooltip="Anexar" mat-icon-button><i
          class="material-icons">attach_file</i></button>
      <button (click)="createTask()" type="submit" class="button right"
        [ngStyle]="{'background-color': mainStyle}">{{ 'Criar' | translate }}</button>
    </div>
  </form>
</div>