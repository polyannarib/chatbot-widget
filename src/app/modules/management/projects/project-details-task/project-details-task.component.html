<div id="modal">
  <div class="modal-header">
    <span [ngStyle]="{'background-color': mainStyle}" *ngIf="data.project.parent"> {{ data.project.parent.name }}
    </span> <br *ngIf="data.project.parent">
    {{ data.project.name }}
    <button [ngStyle]="{'background-color': mainStyle}" (click)="addTask(0, 0)"
      class="button btnAddProject button-floating" mat-icon-button matTooltip="{{ 'Adicionar' | translate }}">
      <i class="material-icons" style="color:black">add</i>
    </button>
    <button type="button" class="close btn" [mat-dialog-close]="true">
      <i class="material-icons">close</i>
    </button>
  </div>
  <div class="modal-body">
    <app-loading [loader]="loader"></app-loading>
    <app-count *ngIf="tasks?.length == 0 && !loader">Esse projeto está sem task cadastrada no momento!</app-count>

    <div *ngIf="tasks && !loader && tasks?.length > 0">
      <table class="TreeHeader">
        <tr>
          <td></td>
          <td class="maxWidth">Data Inicio</td>
          <td class="maxWidth">Data Final</td>
          <td class="maxWidth">Cartas</td>
          <td class="maxWidth">Responsável</td>
          <td class="maxWidth">Esforço</td>
        </tr>
      </table>
      <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
        <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding>
          <ng-container *ngIf="node?.status != 'REMOVED'">
            <button mat-icon-button disabled></button>
            <button (click)="editTask(node)" class="button button-primary button-floating right" mat-icon-button
              matTooltip="{{ 'Editar' | translate }}">
              <i class="material-icons" style="color:black">edit</i>
            </button>
            <button *ngIf="typeSon(node)" (click)="addTask(node.type, node.id)"
              class="button button-primary button-floating right" mat-icon-button
              matTooltip="{{ 'Adicionar' | translate }}">
              <i class="material-icons" style="color:black">add</i>
            </button>
            <button (click)="removeTask(node)" class="button button-primary button-floating right" mat-icon-button
              matTooltip="{{ 'Remover' | translate }}">
              <i class="material-icons" style="color:black">remove</i>
            </button>
            <i *ngIf="node.type.definition == 'EXECUTAVEL'" class="material-icons"
              matTooltip="{{ node.status | translate }}"
              [ngStyle]="{'color': getColor(node.status)}">fiber_manual_record</i>
            <table>
              <tr>
                <td> <span [ngStyle]="{'background-color': secoundStyle}"> {{ node.type.name }} </span> {{ node.name }}
                </td>
                <td class="maxWidth">{{ node.expectedAt | date:'dd/MM/yyyy' }}</td>
                <td class="maxWidth">{{ node.previewedAt | date:'dd/MM/yyyy' }}</td>
                <td class="maxWidth">{{ getCardName(node.cards) }}</td>
                <td class="maxWidth">{{ node.player?.name }}</td>
                <td class="maxWidth">{{ node.duration }}</td>
              </tr>
            </table>
          </ng-container>
        </mat-tree-node>
        <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>

          <ng-container *ngIf="note?.status != 'REMOVED'">
            <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle' + node.id">
              <i class="material-icons">
                {{ treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right' }}
              </i>
            </button>
            <button (click)="editTask(node)" class="button button-primary button-floating right" mat-icon-button
              matTooltip="{{ 'Editar' | translate }}">
              <i class="material-icons" style="color:black">edit</i>
            </button>
            <button *ngIf="typeSon(node.type)" (click)="addTask(node.type, node.id)"
              class="button button-primary button-floating right" mat-icon-button
              matTooltip="{{ 'Adicionar' | translate }}">
              <i class="material-icons" style="color:black">add</i>
            </button>
            <button [disabled]="isStatus(node.status)" (click)="removeTask(node)"
              class="button button-primary button-floating right" mat-icon-button
              matTooltip="{{ 'Remover' | translate }}">
              <i class="material-icons" style="color:black">remove</i>
            </button>
            <i *ngIf="node.type.definition == 'EXECUTAVEL'" class="material-icons"
              matTooltip="{{ node.status | translate }}"
              [ngStyle]="{'color': getColor(node.status)}">fiber_manual_record</i>
            <table>
              <tr>
                <td> <span [ngStyle]="{'background-color': secoundStyle}"> {{ node.type.name }} </span> {{ node.name }}
                </td>
                <td class="maxWidth">{{ node.expectedAt | date:'dd/MM/yyyy' }}</td>
                <td class="maxWidth">{{ node.previewedAt | date:'dd/MM/yyyy' }}</td>
                <td class="maxWidth">{{ getCardName(node.card) }}</td>
                <td class="maxWidth">{{ node.player?.name }}</td>
                <td class="maxWidth">{{ node.duration }}</td>
              </tr>
            </table>
          </ng-container>
        </mat-tree-node>
      </mat-tree>
    </div>
  </div>

  <div class="modal-footer">
    <button (click)="openReport()" matTooltip="Adicionar nota" mat-icon-button><i
        class="material-icons">assignment</i></button>
    <button (click)="editProject()" matTooltip="{{ 'EDIT_PROJECT' | translate }}" mat-icon-button><i
        class="material-icons">create</i></button>
    <button (click)="createEpic()" matTooltip="{{ 'CREATE_EPIC' | translate }}" *ngIf="data.project.parent === null"
      mat-icon-button><i class="material-icons">note_add</i></button>
    <button [mat-dialog-close]="true" target="_blank"
      class="button button-primary right">{{ 'OK' | translate }}</button>
  </div>
</div>